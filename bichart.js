!function(){var t={version:"0.1.0",classname:"bichart"};t.canvas=function(e,n){var a=n||{top:0,right:0,bottom:0,left:0},r=d3.select(e),s=r.node().clientWidth,l=r.node().clientHeight,i=r.append("svg").attr("width",s).attr("height",l),o=i.append("g").attr("class",t.classname+"-g-root").attr("transform","translate("+a.left+","+a.top+")");return{outer:{object:i,width:s,height:l,left:0,top:0},inner:{object:o,width:s-a.left-a.right,height:l-a.top-a.bottom,left:a.left,top:a.top}}},t.helper={rgbToHex:function(t,e,n){return"#"+("0"+t.toString(16)).slice(-2)+("0"+e.toString(16)).slice(-2)+("0"+n.toString(16)).slice(-2)},hexToRgb:function(t){var e=parseInt(t.slice(1),16),n=e>>16&255,a=e>>8&255,r=255&e;return[n,a,r]},hslToRgb:function(t,e,n){function a(t,e,n){return 0>n&&(n+=1),n>1&&(n-=1),1/6>n?t+6*(e-t)*n:.5>n?e:2/3>n?t+(e-t)*(2/3-n)*6:t}var r,s,l;if(0==e)r=s=l=n;else{var i=.5>n?n*(1+e):n+e-n*e,o=2*n-i;r=a(o,i,t+1/3),s=a(o,i,t),l=a(o,i,t-1/3)}var c=Math.round(255*r),u=Math.round(255*s),f=Math.round(255*l);return this.rgbToHex(c,u,f)},colors:function(e,n,a,r,s){if(!arguments||1>e)return function(){return"#000"};for(var l,i=[],o=n||0;e>o;o+=a||1){var c=t.helper.hslToRgb(o/e,r||1,s||.6);i.push(c)}return l=function(t){return i[t]},function(t){return l(t)}},colorSeries:function(t,e,n){var a=.8/e/4,r=.5/e/4;return this.colors(t*e,n,e,.8-n*a,.5-n*r)},brigherColor:function(t){var e=this.hexToRgb(t),n=e.map(function(t){return Math.min(30>=t?60:t/.5,255)});return this.rgbToHex(n[0],n[1],n[2])},escapeName:function(t){return t.replace(/ /g,"").replace(/_/g,"").replace(/&/g,"").replace(/@/g,"")},getCenter:function(t){return[t.clientWidth/2+t.clientLeft,t.clientHeight/2+t.clientTop]},getBounds:function(t){for(var e=t;!e.clientWidth||!e.clientHeight;)e=e.parentElement;return new Rectangle(e.clientLeft,e.clientTop,e.clientWidth,e.clientHeight)},getRandomInt:function(t,e){return Math.floor(Math.random()*(e-t+1))+t},unique0:function(t){return t.reverse().filter(function(t,e,n){return-1===n.indexOf(t,e+1)}).reverse()},unique:function(t,e){var n=t.map(function(t){return t[e]});return n.reverse().filter(function(t,e,n){return-1===n.indexOf(t,e+1)}).reverse()}},t.chart=function(t){var a,r={},s=[];r.line=function(){return a||(a=new e,s.push(a)),a};var l;return r.pie=function(){return l||(l=new n,s.push(l)),l},r.draw=function(e,n){s.forEach(function(a,r){a.draw(t,s.length,r,e,n)})},r};var e=function(){function e(t,e,n,a){var r=n;if(!r){var s=t.selectAll("g."+i.xAxisClassname).data([]);return void s.exit().remove()}var l,o=Object.keys(r.values());l||(l=d3.scale.ordinal().domain(o).rangePoints([0,e.width]));var c=d3.svg.axis().scale(l).orient("bottom").tickValues(o),s=t.selectAll("g."+i.xAxisClassname).data([0],function(t,e){return t});return s.exit().remove(),s.enter().append("g").attr("class",i.axisClassname+" "+i.xAxisClassname).attr("transform","translate(0,"+e.height+")").append("text").attr("class","xtitle"),s.call(c),s.selectAll("text").attr("x",-9).attr("y",0).attr("dy",".35em").attr("transform","rotate(-90)").style("text-anchor","end"),s.selectAll("text.xtitle").attr("class","xtitle").attr("x",e.width).attr("y",-20).attr("dy",".71em").attr("transform","rotate(0)").text(function(t){return r.display}),l}function n(t,e,n,r){var s=r[0];if(!s){var l=t.selectAll("g."+i.yAxisClassname).data([]);return void l.exit().remove()}var o=[];r.forEach(function(t){o.push(t.alias)});var c=a(n,o,!0);c[0]>0&&(c[0]=0);var u=d3.scale.linear().domain(c).range([e.height,0]),f=d3.svg.axis().scale(u).orient("left").tickFormat(d3.format(".0f"));c[1]<10&&f.ticks(c[1]);var l=t.selectAll("g."+i.yAxisClassname).data([0]);return l.exit().remove(),l.enter().append("g").attr("class",i.axisClassname+" "+i.yAxisClassname).append("text").attr("class","ytitle"),l.call(f).selectAll("text.ytitle").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text(function(t){return s.display}),u}function a(t,e,n){function a(n,r){var s=[];t.forEach(function(t,a){e.forEach(function(e){0==a?(s[e]=[t[e],t[e]],0==r&&(n[e]=[t[e],t[e]])):t[e]<s[e][0]?s[e][0]=t[e]:t[e]>s[e][1]&&(s[e][1]=t[e])})}),e.forEach(function(t){s[t][0]<n[t][0]&&(n[t][0]=s[t][0]),s[t][1]>n[t][1]&&(n[t][1]=s[t][1])}),t.forEach(function(t){t.children&&a(r+1)})}var r={};a(r,0);var s,l=Object.keys(r);return l.length?l.forEach(function(t,e){0==e?s=[r[t][0],r[t][1]]:(s[0]>r[t][0]&&(s[0]=r[t][0]),s[1]<r[t][1]&&(s[1]=r[t][1]))}):s=[0,100],s}function r(t,e,n,a,r){if(0==e.length||0==n.length)return[];var s={};t.forEach(function(t){n.forEach(function(n){var l={};l.cname1=e[0].name,l.cvalue1=t[e[0].alias],e[1]&&(l.cname2=e[1].name,l.cvalue2=t[e[1].alias]||"[All]"),l.sname=n.display,l.svalue=t[n.alias],l.x=a(l.cvalue1),l.y=r(l.svalue),e[1]?(s[n.name+" "+l.cvalue2]||(s[n.name+" "+l.cvalue2]=[])).push(l):(s[n.name]||(s[n.name]=[])).push(l)})});var l=Object.keys(s),i=[];return l.forEach(function(t){i.push(s[t])}),i}function s(e,n,a,s,u,f){var h=l(f),d=r(s,u,f,n,a),v=d3.svg.line().x(function(t){return t.x}).y(function(t){return t.y});if(u[1]){var p=Object.keys(u[1].values()),g=u[1].values();g["[All]"]=p.length}else var p=[0];var _=t.helper.colorSeries(p.length+1,1,0),x=e.selectAll("g."+i.lineGClassname).data(d,function(t,e){return e});x.exit().remove(),x.enter().append("g").attr("class",i.lineGClassname).append("path").attr("class",i.lineClassname),x.each(function(t){var e=d3.select(this);e.select("path."+i.lineClassname).style("stroke",function(t){var e=_(t[0].cvalue2?g[t[0].cvalue2]:0);return t.forEach(function(t){t.__color__=e}),e}).style("stroke-width",o).attr("stroke-dasharray",function(t){return h[t[0].sname]}).on("mouseover",function(t){d3.select(this).style("stroke-width",2*c)}).on("mouseout",function(t){d3.select(this).style("stroke-width",o)}).transition().duration(500).attrTween("d",function(t){var e=this;e.__lastPosition__||(e.__lastPosition__=[],t.forEach(function(t){e.__lastPosition__.push({x:t.x,y:t.y})}));var n=d3.interpolate(e.__lastPosition__,t);return e.__lastPosition__=n(0),function(e){var a=n(e);return v(a.filter(function(e,n){return n<t.length}))}});var n=e.selectAll("circle."+i.pointClassname).data(t,function(t){return t.x+" "+t.y});n.exit().remove(),n.enter().append("circle").attr("class",i.pointClassname).on("mouseover",function(t){return d3.select(this).attr("r",2*c),m.show.call(this,t)}).on("mouseout",function(t){return d3.select(this).attr("r",c),m.hide.call(this,t)}),n.attr("r",c).attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y}).style("fill",function(t){return t.__color__})})}function l(t){var e={};return t.forEach(function(t,n){var a="";if(n>0){for(var r="",s=0;n>s;s++)a=a+r+f+","+f,r=",";a=a+","+f}else a="0";e[t.display]=u+","+a}),e}var i={classname:t.classname+"-line"};i.axisClassname=i.classname+"-axis",i.xAxisClassname=i.classname+"-x",i.yAxisClassname=i.classname+"-y",i.lineGClassname=i.classname+"-g-line",i.lineClassname=i.classname+"-line",i.pointClassname=i.classname+"-point",i.tipClassnames=t.classname+"-tip "+i.classname+"-tip";var o=2;i.lineWidth=function(t){return arguments.length?(o=t,i):o};var c=3;i.pointRadius=function(t){return arguments.length?(c=t,i):c};var u=20;i.dashFilled=function(t){return arguments.length?(u=t,i):u};var f=3;i.dashUnfilled=function(t){return arguments.length?(f=t,i):f};var h,m=d3.tip().attr("class",i.tipClassnames).offset([-10,0]).html(function(t){var e=t.cname1+": "+t.cvalue1;return t.cname2&&(e+="<br/>"+t.cname2+": "+t.cvalue2),e+="<br/>"+t.sname+": "+t.svalue});return i.draw=function(t,a,r,l,i){if(i.series){h=i;var o=i.data,c=i.category,u=i.series,f=t.inner.object,d=new Rectangle(0,0,t.inner.width,t.inner.height);f.call(m);var v=e(f,d,c[0],l),p=n(f,d,o,u);s(f,v,p,o,c,u)}},i},n=function(){function e(t,n,a,r){var s=1,m=[];r.forEach(function(t){m[t]=0}),t.forEach(function(t,e){r.forEach(function(e){var n=parseInt(t[e])||s;m[e]+=Math.abs(n)})}),m.forEach(function(t){0==t&&(t=1)});var d=o+n*c+(n-1)*u,v=d+c*h,p=d+c;t.forEach(function(o,c){o.__level__=n;var u={};r.forEach(function(e){var r=a[e],h=parseFloat(o[e])||s;o[i+e]=[d,0>h?v:p];var g=Math.abs(h)/m[e]*(r[1]-r[0]),_=0==c?r[0]:t[c-1][l+e][1],x=c==t.length-1?r[1]:_+g;t.length>1&&(_+=f/Math.pow(2,n)),o[l+e]=[_,x],u[e]=[o[l+e][0],o[l+e][1]]}),o.children&&e(o.children,n+1,u,r)})}function n(t,e,n,a){var r=t.selectAll("g.bichart-g-root > g."+s.valueClassname).data(n,function(t,e){return e});return r.exit().remove(),r.transition().duration(1e3).attr("transform",function(t){return"translate("+e[t].left+","+e[t].top+")"}).each(function(t,e){var n=d3.select(this),r=n.selectAll("g."+s.valueClassname+" > g."+s.colorClassname).data(a,function(t,e){return e});r.exit().remove(),r.enter().append("g").attr("class",s.colorClassname).attr("transform",function(t){return"translate(0,0)"})}),r.enter().append("g").style({width:"100%",height:"100%"}).attr("class",s.valueClassname).attr("transform",function(t){return"translate("+e[t].left+","+e[t].top+")"}).each(function(t,e){var n=d3.select(this),r=n.selectAll("g."+s.valueClassname+" > g."+s.colorClassname).data(a,function(t,e){return e});r.exit().remove(),r.enter().append("g").attr("class",s.colorClassname).attr("transform",function(t){return"translate(0,0)"})}),r}function a(e,n,l,i,o){var c,u,f;e.each(function(t,e){e!=l||c||(c=d3.select(this),u=t.alias,f=t.name)});var h=Object.keys(o[l]).length,m=t.helper.colorSeries(h,o.length,l),d=c.selectAll("path").data(n,function(t,e){return t.__ids__||1});d.exit().remove(),d.enter().append("path").attr("class",function(e){return t.helper.escapeName(s.pathClassname+"-"+f+"-"+e[u])}).on("mouseover",function(e){return d3.select(this).style("fill",t.helper.brigherColor(this.__color__)),p.show.call(this,e)}).on("mouseout",function(t){return d3.select(this).style("fill",this.__color__),p.hide.call(this,t)}),d.style("fill",function(t){var e=m(o[l][t[u]]||0);return this.__series__=i,this.__color__=e,e}).transition().duration(500).attrTween("d",function(t){return r(this,t,i)});var v=[];n.forEach(function(t,e){t.children&&t.children.forEach(function(t){v.push(t)})}),v.length>0&&a(e,v,l+1,i,o)}function r(t,e,n){var a=e[l+n],r=e[i+n];t.__current__||(t.__current__={startAngle:1==m?0:a[0],endAngle:1==m?a[1]:a[0],innerRadius:r[0],outerRadius:1==m?r[0]+c:r[1]});var s={startAngle:a[0],endAngle:a[1],innerRadius:r[0],outerRadius:r[1]},o=d3.interpolate(t.__current__,s);t.__current__=o(0);var u=d3.svg.arc();return function(t){var e=o(t);return u(e)}}var s={classname:t.classname+"-pie"};s.valueClassname=s.classname+"-value",s.colorClassname=s.classname+"-color",s.pathClassname=s.classname+"-path",s.tipClassnames=t.classname+"-tip "+s.classname+"-tip";var l="angle_",i="radius_",o=0;s.baseRadius=function(t){return arguments.length?(o=t,s):o};var c=30;s.width=function(t){return arguments.length?(c=t,s):c};var u=10;s.ringGap=function(t){return arguments.length?(u=t,s):u};var f=.01;s.arcGap=function(t){return arguments.length?(t>0&&t<Math.PI&&(f=t),s):u};var h=1;s.negativeRatio=function(t){return arguments.length?(t>0&&2>t&&(h=t),s):h};var m=1;s.animationMode=function(t){return arguments.length?(m=t,s):m};var d=0,v=[];v[d]={},s.level=function(){return d++,v[d]={},s},s.color=function(t){return"function"==typeof t?(v[d].color=t,s):v[d][color](t)};var p=d3.tip().attr("class",s.tipClassnames).offset([-10,0]).html(function(t){var e,n=this.__series__,a=g.category.reduce(function(e,n){var a="undefined"==typeof t[n.alias]?"":n.display+": "+t[n.alias];return e?e+"<br/>"+a:a},"");return g.series.forEach(function(t){t.alias==n&&(e=t)}),e?a+"<br/>"+e.display+": "+t[n]:a});s.tooltip=function(t){};var g;return s.draw=function(t,r,s,l,i){g=i;var f=t.inner.object;f.call(p);var h=new SimpleLayout(new Rectangle(-t.inner.left/2,-t.inner.top/2,t.inner.width,t.inner.height)),m=[],d=[];i.series.forEach(function(t){m.push(t.alias),d[t.alias]=[0,2*Math.PI]});var v=i.data;e(v,0,d,m);var _=[],x=[];i.category.forEach(function(t){_.push(t.alias),x.push(t.values())});var y=o+x.length*c+(x.length-1)*u;y*=2;var C=h.doLayout(new Dimension(y,y),m),b=n(f,C,m,i.category);b.each(function(t,e){var n=d3.select(this);a(n.selectAll("g > g"),v,0,t,x)})},s};t.table=function(e,n){var a={classname:t.classname+"-table"},r=d3.select(e),s=d3.keys(n[0]);r.append("tr").attr("class",a.classname+"-header").selectAll("th").data(s).enter().append("th").attr("class",function(t,e){return a.classname+"-column "+a.classname+"-column-"+e}).html(function(t){return t});var l=r.selectAll("tr."+a.classname+"-row").data(n).enter().append("tr").attr("class",a.classname+"-row");return l.selectAll("td."+a.classname+"-column").data(function(t){return d3.entries(t)}).enter().append("td").attr("class",function(t,e){return a.classname+"-column "+a.classname+"-column-"+e}).html(function(t){return t.value}),a},"function"==typeof define&&define.amd?(this.bichart=t,define(t)):"object"==typeof module&&module.exports?module.exports=t:this.bichart=t}();