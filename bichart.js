!function(){var t={version:"0.1.0",classname:"bichart"};t.canvas=function(e,n){var a=n||{top:0,right:0,bottom:0,left:0},r="string"==typeof e?d3.select(e):e,s=r.node().clientWidth,i=r.node().clientHeight,o=r.append("svg").attr("width",s).attr("height",i).style("overflow","visible"),l=o.append("g").attr("class",t.classname+"-g-root").attr("transform","translate("+a.left+","+a.top+")");return{outer:{object:o,width:s,height:i,left:0,top:0},inner:{object:l,width:s-a.left-a.right,height:i-a.top-a.bottom,left:a.left,top:a.top}}},t.googleMapCanvas=function(t,e,n){var a=d3.select(t),r=a.node().clientWidth,s=a.node().clientHeight,i=new google.maps.Map(a.node(),{zoom:n||11,center:new google.maps.LatLng(e?e[0]:0,e?e[1]:0),mapTypeId:google.maps.MapTypeId.TERRAIN}),o=new google.maps.OverlayView;return o.setMap(i),{outer:{object:a,width:r,height:s,left:0,top:0},inner:{object:o,width:r,height:s,left:0,top:0}}},t.helper={rgbToHex:function(t,e,n){return"#"+("0"+t.toString(16)).slice(-2)+("0"+e.toString(16)).slice(-2)+("0"+n.toString(16)).slice(-2)},hexToRgb:function(t){var e=parseInt(t.slice(1),16),n=e>>16&255,a=e>>8&255,r=255&e;return[n,a,r]},hslToRgb:function(t,e,n){function a(t,e,n){return 0>n&&(n+=1),n>1&&(n-=1),1/6>n?t+6*(e-t)*n:.5>n?e:2/3>n?t+(e-t)*(2/3-n)*6:t}var r,s,i;if(0==e)r=s=i=n;else{var o=.5>n?n*(1+e):n+e-n*e,l=2*n-o;r=a(l,o,t+1/3),s=a(l,o,t),i=a(l,o,t-1/3)}var c=Math.round(255*r),u=Math.round(255*s),f=Math.round(255*i);return this.rgbToHex(c,u,f)},colors:function(e,n,a,r,s){if(!arguments||1>e)return function(){return"#000"};for(var i,o=[],l=n||0;e>l;l+=a||1){var c=t.helper.hslToRgb(l/e,r||1,s||.6);o.push(c)}return i=function(t){return o[t]},function(t){return i(t)}},colorSeries:function(t,e,n){var a=.8/e/4,r=.5/e/4;return this.colors(t*e,n,e,.8-n*a,.5-n*r)},brigherColor:function(t){var e=this.hexToRgb(t),n=e.map(function(t){return Math.min(30>=t?60:t/.5,255)});return this.rgbToHex(n[0],n[1],n[2])},escapeName:function(t){return t.replace(/ /g,"").replace(/_/g,"").replace(/&/g,"").replace(/@/g,"")},getCenter:function(t){return[t.clientWidth/2+t.clientLeft,t.clientHeight/2+t.clientTop]},getBounds:function(t){for(var e=t;!e.clientWidth||!e.clientHeight;)e=e.parentElement;return new Rectangle(e.clientLeft,e.clientTop,e.clientWidth,e.clientHeight)},getRandomInt:function(t,e){return Math.floor(Math.random()*(e-t+1))+t},unique0:function(t){return t.reverse().filter(function(t,e,n){return-1===n.indexOf(t,e+1)}).reverse()},unique:function(t,e){var n=t.map(function(t){return t[e]});return n.reverse().filter(function(t,e,n){return-1===n.indexOf(t,e+1)}).reverse()}};t.googleMap=function(e){function n(t,e,n){var a=new google.maps.LatLng(n,e);return a=t.fromLatLngToDivPixel(a)}var a={classname:t.classname+"-googlemap"};a.nodeGClassname=a.classname+"-g-node";var r,s,i={},o=e.inner.object;return o.onAdd=function(){var l=d3.select(this.getPanes().overlayMouseTarget).append("div").attr("class","topology").style("width","100%").style("height",e.outer.height+"px").style("overflow","visible"),c=t.canvas(l),u=c.inner.object;o.draw=function(){if(s){var o=s.chartType,l=s.data;if(l){var c=(s.category,s.series),f=this.getProjection(),h=Object.keys(l),d={};h.forEach(function(t){d[t]=n(f,l[t].location.Latitude,l[t].location.Longitude)});var v=u.selectAll("g."+a.nodeGClassname).data(h,function(t,e){return e});v.exit().remove(),v.enter().append("g").attr("class",a.nodeGClassname),v.attr("transform",function(t){return"translate("+d[t].x+","+d[t].y+")"}).each(function(n,a){var s=d3.select(this);if("pie"==o){var f=i[n];if(!f){var h=e.outer.width,d=e.outer.height,v={outer:{object:u,width:h,height:d,left:0,top:0},inner:{object:s,width:h,height:d,left:0,top:0}};f=t.pie(v),f.baseRadius(0).width(15).ringGap(5).arcGap(.01).negativeRatio(1.2).animationMode(0),i[n]=f}var m={};c.forEach(function(t){m[t.alias]={x:0,y:0}}),f.draw(r,l[n],"topLeft")}})}}}},a.draw=function(t,e){r=t,s=e,o.draw()},a},t.line=function(e){function n(t,e,n,a){var r=n;if(!r){var s=t.selectAll("g."+l.xAxisClassname).data([]);return void s.exit().remove()}var i,o=Object.keys(r.values());i||(i=d3.scale.ordinal().domain(o).rangePoints([0,e.width]));var c=d3.svg.axis().scale(i).orient("bottom").tickValues(o),s=t.selectAll("g."+l.xAxisClassname).data([0],function(t,e){return t});return s.exit().remove(),s.enter().append("g").attr("class",l.axisClassname+" "+l.xAxisClassname).attr("transform","translate(0,"+e.height+")").append("text").attr("class","xtitle"),s.call(c),s.selectAll("text").attr("x",-9).attr("y",0).attr("dy",".35em").attr("transform","rotate(-90)").style("text-anchor","end"),s.selectAll("text.xtitle").attr("class","xtitle").attr("x",e.width).attr("y",-20).attr("dy",".71em").attr("transform","rotate(0)").text(function(t){return r.display}),i}function a(t,e,n,a){var s=a[0];if(!s){var i=t.selectAll("g."+l.yAxisClassname).data([]);return void i.exit().remove()}var o=[];a.forEach(function(t){o.push(t.alias)});var c=r(n,o,!0);c[0]>0&&(c[0]=0);var u=d3.scale.linear().domain(c).range([e.height,0]),f=d3.svg.axis().scale(u).orient("left").tickFormat(d3.format(".0f"));c[1]<10&&f.ticks(c[1]);var i=t.selectAll("g."+l.yAxisClassname).data([0]);return i.exit().remove(),i.enter().append("g").attr("class",l.axisClassname+" "+l.yAxisClassname).append("text").attr("class","ytitle"),i.call(f).selectAll("text.ytitle").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text(function(t){return s.display}),u}function r(t,e,n){function a(n,r){var s=[];t.forEach(function(t,a){e.forEach(function(e){0==a?(s[e]=[t[e],t[e]],0==r&&(n[e]=[t[e],t[e]])):t[e]<s[e][0]?s[e][0]=t[e]:t[e]>s[e][1]&&(s[e][1]=t[e])})}),e.forEach(function(t){s[t][0]<n[t][0]&&(n[t][0]=s[t][0]),s[t][1]>n[t][1]&&(n[t][1]=s[t][1])}),t.forEach(function(t){t.children&&a(r+1)})}var r={};a(r,0);var s,i=Object.keys(r);return i.length?i.forEach(function(t,e){0==e?s=[r[t][0],r[t][1]]:(s[0]>r[t][0]&&(s[0]=r[t][0]),s[1]<r[t][1]&&(s[1]=r[t][1]))}):s=[0,100],s}function s(t,e,n,a,r){if(0==e.length||0==n.length)return[];var s={};t.forEach(function(t){n.forEach(function(n){var i={};i.cname1=e[0].name,i.cvalue1=t[e[0].alias],e[1]&&(i.cname2=e[1].name,i.cvalue2=t[e[1].alias]||"[All]"),i.sname=n.display,i.svalue=t[n.alias],i.x=a(i.cvalue1),i.y=r(i.svalue),e[1]?(s[n.name+" "+i.cvalue2]||(s[n.name+" "+i.cvalue2]=[])).push(i):(s[n.name]||(s[n.name]=[])).push(i)})});var i=Object.keys(s),o=[];return i.forEach(function(t){o.push(s[t])}),o}function i(e,n,a,r,i,f){var h=o(f),d=s(r,i,f,n,a),m=d3.svg.line().x(function(t){return t.x}).y(function(t){return t.y});if(i[1]){var g=Object.keys(i[1].values()),p=i[1].values();p["[All]"]=g.length}else var g=[0];var _=t.helper.colorSeries(g.length+1,1,0),y=e.selectAll("g."+l.lineGClassname).data(d,function(t,e){return e});y.exit().remove(),y.enter().append("g").attr("class",l.lineGClassname).append("path").attr("class",l.lineClassname),y.each(function(t){var e=d3.select(this);e.select("path."+l.lineClassname).style("stroke",function(t){var e=_(t[0].cvalue2?p[t[0].cvalue2]:0);return t.forEach(function(t){t.__color__=e}),e}).style("stroke-width",c).attr("stroke-dasharray",function(t){return h[t[0].sname]}).on("mouseover",function(t){d3.select(this).style("stroke-width",2*u)}).on("mouseout",function(t){d3.select(this).style("stroke-width",c)}).transition().duration(500).attrTween("d",function(t){var e=this;e.__lastPosition__||(e.__lastPosition__=[],t.forEach(function(t){e.__lastPosition__.push({x:t.x,y:t.y})}));var n=d3.interpolate(e.__lastPosition__,t);return e.__lastPosition__=n(0),function(e){var a=n(e);return m(a.filter(function(e,n){return n<t.length}))}});var n=e.selectAll("circle."+l.pointClassname).data(t,function(t){return t.x+" "+t.y});n.exit().remove(),n.enter().append("circle").attr("class",l.pointClassname).on("mouseover",function(t){return d3.select(this).attr("r",2*u),v.show.call(this,t)}).on("mouseout",function(t){return d3.select(this).attr("r",u),v.hide.call(this,t)}),n.attr("r",u).attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y}).style("fill",function(t){return t.__color__})})}function o(t){var e={};return t.forEach(function(t,n){var a="";if(n>0){for(var r="",s=0;n>s;s++)a=a+r+h+","+h,r=",";a=a+","+h}else a="0";e[t.display]=f+","+a}),e}var l={classname:t.classname+"-line"};l.axisClassname=l.classname+"-axis",l.xAxisClassname=l.classname+"-x",l.yAxisClassname=l.classname+"-y",l.lineGClassname=l.classname+"-g-line",l.lineClassname=l.classname+"-line",l.pointClassname=l.classname+"-point",l.tipClassnames=t.classname+"-tip "+l.classname+"-tip";var c=2;l.lineWidth=function(t){return arguments.length?(c=t,l):c};var u=3;l.pointRadius=function(t){return arguments.length?(u=t,l):u};var f=20;l.dashFilled=function(t){return arguments.length?(f=t,l):f};var h=3;l.dashUnfilled=function(t){return arguments.length?(h=t,l):h};var d,v=d3.tip().attr("class",l.tipClassnames).offset([-10,0]).html(function(t){var e=t.cname1+": "+t.cvalue1;return t.cname2&&(e+="<br/>"+t.cname2+": "+t.cvalue2),e+="<br/>"+t.sname+": "+t.svalue});return l.draw=function(t,r){if(r.series){d=r;var s=r.data,o=r.category,l=r.series,c=e.inner.object,u={width:e.inner.width,height:e.inner.height};c.call(v);var f=n(c,u,o[0],t),h=a(c,u,s,l);i(c,f,h,s,o,l)}},l},t.pie=function(e){function n(t,e,a,r){var s=1,i=[];r.forEach(function(t){i[t]=0}),t.forEach(function(t,e){r.forEach(function(e){var n=parseInt(t[e])||s;i[e]+=Math.abs(n)})}),i.forEach(function(t){0==t&&(t=1)});var v=c+e*u+(e-1)*f,m=v+u*d,g=v+u;t.forEach(function(c,u){c.__level__=e;var f={};r.forEach(function(n){var r=a[n],d=parseFloat(c[n])||s;c[l+n]=[v,0>d?m:g];var p=Math.abs(d)/i[n]*(r[1]-r[0]),_=0==u?r[0]:t[u-1][o+n][1],y=u==t.length-1?r[1]:_+p;t.length>1&&(_+=h/Math.pow(2,e)),c[o+n]=[_,y],f[n]=[c[o+n][0],c[o+n][1]]}),c.children&&n(c.children,e+1,f,r)})}function a(t,e,n,a){var r=t.selectAll("g."+i.valueClassname).data(n,function(t,e){return e});return r.exit().remove(),r.transition().duration(500).attr("transform",function(t){return"translate("+e[t].x+","+e[t].y+")"}),r.enter().append("g").style({width:"100%",height:"100%"}).attr("class",i.valueClassname).attr("transform",function(t){return"translate("+e[t].x+","+e[t].y+")"}),r.each(function(t,e){var n=d3.select(this),r=n.selectAll("g."+i.valueClassname+" > g."+i.colorClassname).data(a,function(t,e){return e});r.exit().remove(),r.enter().append("g").attr("class",i.colorClassname).attr("transform",function(t){return"translate(0,0)"})}),r}function r(e,n,a,o,l){var c,u,f;e.each(function(t,e){e!=a||c||(c=d3.select(this),u=t.alias,f=t.name)});var h=Object.keys(l[a]).length,d=t.helper.colorSeries(h,l.length,a),v=c.selectAll("path").data(n,function(t,e){return t.__ids__||1});v.exit().remove(),v.enter().append("path").attr("class",function(e){return t.helper.escapeName(i.pathClassname+"-"+f+"-"+e[u])}).on("mouseover",function(e){return d3.select(this).style("fill",t.helper.brigherColor(this.__color__)),_.show.call(this,e)}).on("mouseout",function(t){return d3.select(this).style("fill",this.__color__),_.hide.call(this,t)}),v.style("fill",function(t){var e=d(l[a][t[u]]||0);return this.__series__=o,this.__color__=e,e}).transition().duration(500).attrTween("d",function(t){return s(this,t,o)});var m=[];n.forEach(function(t,e){t.children&&t.children.forEach(function(t){m.push(t)})}),m.length>0&&r(e,m,a+1,o,l)}function s(t,e,n){var a=e[o+n],r=e[l+n];t.__current__||(t.__current__={startAngle:1==v?0:a[0],endAngle:1==v?a[1]:a[0],innerRadius:r[0],outerRadius:1==v?r[0]+u:r[1]});var s={startAngle:a[0],endAngle:a[1],innerRadius:r[0],outerRadius:r[1]},i=d3.interpolate(t.__current__,s);t.__current__=i(0);var c=d3.svg.arc();return function(t){var e=i(t);return c(e)}}var i={classname:t.classname+"-pie"};i.valueClassname=i.classname+"-value",i.colorClassname=i.classname+"-color",i.pathClassname=i.classname+"-path",i.tipClassnames=t.classname+"-tip "+i.classname+"-tip";var o="angle_",l="radius_",c=0;i.baseRadius=function(t){return arguments.length?(c=t,i):c};var u=30;i.width=function(t){return arguments.length?(u=t,i):u};var f=10;i.ringGap=function(t){return arguments.length?(f=t,i):f};var h=.01;i.arcGap=function(t){return arguments.length?(t>0&&t<Math.PI&&(h=t),i):f};var d=1;i.negativeRatio=function(t){return arguments.length?(t>0&&2>t&&(d=t),i):d};var v=1;i.animationMode=function(t){return arguments.length?(v=t,i):v};var m=0,g=[];g[m]={},i.level=function(){return m++,g[m]={},i},i.color=function(t){return"function"==typeof t?(g[m].color=t,i):g[m][color](t)};var p,_=d3.tip().attr("class",i.tipClassnames).offset([-10,0]).html(function(t){var e,n=this.__series__,a=p.category.reduce(function(e,n){var a="undefined"==typeof t[n.alias]?"":n.display+": "+t[n.alias];return e?e+"<br/>"+a:a},"");return p.series.forEach(function(t){t.alias==n&&(e=t)}),e?a+"<br/>"+e.display+": "+t[n]:a}),y=bilayout.circle();return i.draw=function(t,s,i){p=s;var o=e.inner.object;o.call(_);var l=[],h=[];s.series.forEach(function(t){console.log("value field: ",t),l.push(t.alias),h[t.alias]=[0,2*Math.PI]});var d=s.data;n(d,0,h,l);var v=[],m=[];s.category.forEach(function(t){console.log("color field: ",t),v.push(t.alias),m.push(t.values())});var g=c+m.length*u+(m.length-1)*f,x=1.6*g,b="topLeft"==i?-e.outer.left:e.inner.width/2,w="topLeft"==i?-e.outer.top:e.inner.height/2;console.log("location",b,w,e);var C=y.radius(x).cx(b).cy(w).drawingObjectRadius(g).showBoundary(o).showCenter(o).calculate(l.length),A={};l.forEach(function(t,e){A[t]=C[e]});var E=a(o,A,l,s.category);E.each(function(t,e){var n=d3.select(this);r(n.selectAll("g > g"),d,0,t,m)})},i},t.table=function(e,n){var a={classname:t.classname+"-table"},r=d3.select(e),s=d3.keys(n[0]);r.append("tr").attr("class",a.classname+"-header").selectAll("th").data(s).enter().append("th").attr("class",function(t,e){return a.classname+"-column "+a.classname+"-column-"+e}).html(function(t){return t});var i=r.selectAll("tr."+a.classname+"-row").data(n).enter().append("tr").attr("class",a.classname+"-row");return i.selectAll("td."+a.classname+"-column").data(function(t){return d3.entries(t)}).enter().append("td").attr("class",function(t,e){return a.classname+"-column "+a.classname+"-column-"+e}).html(function(t){return t.value}),a},"function"==typeof define&&define.amd?(this.bichart=t,define(t)):"object"==typeof module&&module.exports?module.exports=t:this.bichart=t}();